(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{212:function(e,n,t){"use strict";t.r(n);var r=t(85),a=t(0),o=t.n(a),l=t(71),u=t.n(l),c=t(8),i=t.n(c),s=t(15),d=t(12),m=t(38),f=t(214),p=t(216),b=t(215),v=function(e){if(!e.show)return null;if(console.log("round",e.round),!e.round)return console.log("no round chosen"),null;if(e.allPointsQuery.loading)return console.log("loading"),o.a.createElement("div",null,"loading...");if(e.allPointsQuery.error)return console.log("error",e.allPointsQuery.error),o.a.createElement("div",null,"error...");var n=e.round.users,t=e.trackIndex,r=e.allPointsQuery.data.allPoints,a=e.round,l=n.slice(),u=function(e){var n=-1;return e.forEach(function(e){n<e&&(n=e)}),n}(r.map(function(e){return e.trackIndex}));if(-1===t)return e.changeTrack(u),null;var c=function(n){return function(){e.changeTrack(n)}},i=function(n,t){return function(){n>-1&&e.updatePoint(n,t.id)}};l.sort(function(e,n){for(var a=function(t){var a=r.filter(function(e){return e.trackIndex===t}),o=a.filter(function(n){return n.user.id===e.id}),l=a.filter(function(e){return e.user.id===n.id});if(0===o.length||0===l.length)return{v:0};var u=o[0].points,c=l[0].points;return u>c?{v:1}:u<c?{v:-1}:void 0},o=t;o>=0;o--){var l=a(o);if("object"===typeof l)return l.v}return 0}),console.log("order",l);u+1===t&&e.addNewTrack();for(var s=[],d=0;d<u+1;d++)s.push(o.a.createElement("th",{key:d},d+1));return o.a.createElement("div",{className:"App"},o.a.createElement("div",null,o.a.createElement("h3",null,a.location.name),o.a.createElement("h3",null,o.a.createElement("button",{text:"-",onClick:c(t-1)},"-"),"Track ",t+1,o.a.createElement("button",{text:"+",onClick:c(t+1)},"+")),o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"order"),o.a.createElement("th",null,"player"),s,o.a.createElement("th",null,"total"))),o.a.createElement("tbody",null,n.map(function(e){var n=r.filter(function(n){return n.user.id===e.id});if(n){n.sort(function(e,n){return e.trackIndex-n.trackIndex});var a=0===n.length?0:n.map(function(e){return e.points}).reduce(function(e,n){return e+n});return o.a.createElement("tr",{key:e.id},o.a.createElement("td",{key:"order"},function(e){for(var n=0;n<l.length;n++)if(e===l[n])return n+1+".";return"err"}(e)),o.a.createElement("td",{key:e.username},e.username),n.map(function(n){return n.trackIndex===t?o.a.createElement("td",{key:n.trackIndex+e.id},o.a.createElement("b",null,o.a.createElement("button",{className:"ui button",onClick:i(n.points-1,n.user)},"-"),n.points,o.a.createElement("button",{className:"ui button",onClick:i(n.points+1,n.user)},"+"))):o.a.createElement("td",{key:n.trackIndex+e.id},n.points)}),o.a.createElement("td",null,a))}return o.a.createElement("tr",null,o.a.createElement("td",null,"no plays"))})))),o.a.createElement("div",null,o.a.createElement("button",{className:"ui button",text:"delete last track",onClick:function(){e.deleteLastTrack()}},"delete last track")),o.a.createElement("div",null,o.a.createElement("button",{className:"ui button",text:"finish round",onClick:function(){e.finishRound()}},"finnish round")),!1)},g=function(e){if(!e.show)return null;if(e.allLocationsQuery.loading||e.allUsersQuery.loading)return console.log("loading"),o.a.createElement("div",null,"loading...");if(e.allLocationsQuery.error||e.allUsersQuery.error)return console.log("errors",e.allUsersQuery.error,e.allLocationsQuery.error),o.a.createElement("div",null,"error...");var n=e.allLocationsQuery.data.allLocations,t=e.allUsersQuery.data.allUsers,r=e.currentLocation,a=e.currentUsers;return r?o.a.createElement("div",null,o.a.createElement("h3",null,"New round"),o.a.createElement("div",{onClick:e.handleLocationClick(r)},r.name),o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",{key:"header"},o.a.createElement("th",null,"selected players"))),o.a.createElement("tbody",null,o.a.createElement("tr",null,a.map(function(n){return o.a.createElement("td",{key:n.id,onClick:e.handleUserClick(n)},n.username)}))))),a.length>0&&r&&o.a.createElement("div",null,o.a.createElement("form",{onSubmit:function(n){console.log("start new round with",r,a),n.preventDefault(),e.startNewRound()}},o.a.createElement("button",{className:"ui button",type:"submit"},"start"))),o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"all players"))),o.a.createElement("tbody",null,t.map(function(n){return o.a.createElement("tr",{key:n.id},o.a.createElement("td",{onClick:e.handleUserClick(n)},n.username))}))))):o.a.createElement("div",null,o.a.createElement("h3",null,"Select location"),o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",{key:"header"},o.a.createElement("th",null,"locations"))),o.a.createElement("tbody",null,n.map(function(n){return o.a.createElement("tr",{key:n.id},o.a.createElement("td",{onClick:e.handleLocationClick(n)},n.name))})))))},E=function(e){if(!e.show)return null;if(e.result.loading)return o.a.createElement("div",null,"loading...");if(e.result.error)return console.log("error",e.result.error),o.a.createElement("div",null,"error...");var n=function(n){return function(){console.log("round clicked",n),e.setRound(n)}},t=e.result.data.allRounds;return t.sort(function(e,n){return n.date-e.date}),console.log("all rounds",t),t?o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",{key:"header"},o.a.createElement("th",null,"location"),o.a.createElement("th",null,"date"),o.a.createElement("th",{colSpan:"99"},"players"))),o.a.createElement("tbody",null,t.map(function(e){var t=new Date(e.date),r=t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return o.a.createElement("tr",{onClick:n(e),key:e.id},o.a.createElement("td",null,e.location.name),o.a.createElement("td",null,r),e.users.map(function(e){return o.a.createElement("td",{key:e.username},e.username)}))})))):null},k=function(e){var n=Object(a.useState)(""),t=Object(d.a)(n,2),r=t[0],l=t[1],u=Object(a.useState)(""),c=Object(d.a)(u,2),m=c[0],f=c[1];if(!e.show)return null;var p=function(){var n=Object(s.a)(i.a.mark(function n(t){return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.preventDefault(),e.doLogin(r,m);case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}();return o.a.createElement("div",{className:"login"},o.a.createElement("h2",null,"Login to application"),o.a.createElement("form",{onSubmit:p,className:"ui form"},o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"Username"),o.a.createElement("input",{id:"username",type:"text",placeholder:"username",value:r,onChange:function(e){l(e.target.value)}})),o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"Password"),o.a.createElement("input",{id:"password",type:"password",placeholder:"password",value:m,onChange:function(e){f(e.target.value)}})),o.a.createElement("button",{className:"ui button",type:"submit"},"login")))},I=t(9),h=t(10),y=t.n(h);function w(){var e=Object(I.a)(["\nmutation deleteLastTrack($roundId: ID!){\n  deleteLastTrack(\n    roundId: $roundId\n  )\n}\n"]);return w=function(){return e},e}function O(){var e=Object(I.a)(["\nmutation addNewTrack($roundId: ID!){\n  addNewTrack(\n    roundId: $roundId\n  ){\n    trackIndex,\n    user{id, username},\n    round{id},\n    points,\n    id\n  }\n}\n"]);return O=function(){return e},e}function j(){var e=Object(I.a)(["\n  mutation addPoints($roundIds: [ID!]!, $userIds: [ID!]!, $trackIndexes:[Int!]!, $points: [Int!]!){\n    addPoints(\n      roundIds: $roundIds,\n      userIds: $userIds,\n      trackIndexes: $trackIndexes,\n      points: $points\n    ){\n      trackIndex,\n      user{id, username},\n      round{id},\n      points,\n      id\n    }\n  }\n"]);return j=function(){return e},e}function x(){var e=Object(I.a)(["\n  mutation addPoint($roundId: ID!, $trackIndex:Int!, $userId: ID!, $points: Int!){\n    addPoint(\n      roundId: $roundId,\n      userId: $userId,\n      trackIndex: $trackIndex,\n      points: $points\n    ){\n      trackIndex,\n      user{id, username},\n      round{id},\n      points,\n      id\n    }\n  }\n"]);return x=function(){return e},e}function $(){var e=Object(I.a)(["\n  mutation createPlay($roundId: ID!, $playNumber:Int!){\n    addPlay(\n      roundId: $roundId,\n      playNumber: $playNumber\n    ){\n      id\n    }\n  }\n"]);return $=function(){return e},e}function N(){var e=Object(I.a)(["\n  mutation createRound($locationId: ID!, $userIds: [ID!]!){\n    addRound(\n      locationId: $locationId\n      userIds: $userIds\n    ){\n      location{\n        name\n        id\n      }\n      users{\n        username\n        id\n      }\n      date\n      id\n    }\n  }\n"]);return N=function(){return e},e}function P(){var e=Object(I.a)(["\n  mutation createLocation($name: String!){\n    addLocation(\n      name: $name\n    ){\n      id, name\n    }\n  }\n"]);return P=function(){return e},e}function Q(){var e=Object(I.a)(["\n{\n  me{\n    username\n    id\n  }\n}\n"]);return Q=function(){return e},e}function S(){var e=Object(I.a)(["\nquery {\n  allUsers{\n    username,\n    id\n  }\n}\n"]);return S=function(){return e},e}function L(){var e=Object(I.a)(["\n  query ($roundId: ID!) {\n    allPoints(\n      roundId: $roundId\n    ){\n    trackIndex,\n    user{id, username},\n    round{id},\n    points,\n    id\n    }\n  }\n"]);return L=function(){return e},e}function C(){var e=Object(I.a)(["\n{\n  allRounds {\n    users{username, id}\n    location{name, id}\n    date\n    id\n  }\n}\n"]);return C=function(){return e},e}function T(){var e=Object(I.a)(["\n{\n  allLocations {\n    name\n    id\n  }\n}  \n"]);return T=function(){return e},e}function q(){var e=Object(I.a)(["\n{\n  me {\n    username\n    id\n    friends{username, id}\n  }\n}\n"]);return q=function(){return e},e}function R(){var e=Object(I.a)(["\nmutation login($username: String!, $password: String! ){\n  login(username: $username, password: $password){\n    token\n    username\n  }\n  \n}\n"]);return R=function(){return e},e}var D=y()(R()),U=(y()(q()),y()(T())),J=y()(C()),M=y()(L()),F=y()(S()),z=(y()(Q()),y()(P()),y()(N())),A=(y()($()),y()(x())),B=y()(j()),H=y()(O()),Y=y()(w());var G=function(){var e=Object(a.useState)([]),n=Object(d.a)(e,2),t=n[0],r=n[1],l=Object(a.useState)(null),u=Object(d.a)(l,2),c=u[0],I=u[1],h=Object(a.useState)(null),y=Object(d.a)(h,2),w=y[0],O=y[1],j=Object(a.useState)([]),x=Object(d.a)(j,2),$=x[0],N=x[1],P=Object(a.useState)(null),Q=Object(d.a)(P,2),S=Q[0],L=Q[1],C=Object(a.useState)(null),T=Object(d.a)(C,2),q=T[0],R=T[1],G=Object(a.useState)(0),K=Object(d.a)(G,2),V=K[0],W=K[1],X=Object(a.useState)(null),Z=Object(d.a)(X,2),_=Z[0],ee=Z[1],ne=Object(a.useState)(null),te=Object(d.a)(ne,2),re=te[0],ae=te[1],oe=Object(a.useState)("main"),le=Object(d.a)(oe,2),ue=le[0],ce=le[1],ie=Object(m.b)();Object(a.useEffect)(function(){var e=localStorage.getItem("username"),n=localStorage.getItem("token");console.log("restore logged user",e,n),ee(n),ae(e)},[]);var se=function(){var e=Object(s.a)(i.a.mark(function e(n,t){var r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be({variables:{username:n,password:t}});case 2:r=e.sent,a=r.data.login.token,o=r.data.login.username,console.log("login token and username",a,o),a&&(ee(a),ae(n),localStorage.setItem("username",o),localStorage.setItem("token",a),ce("main"),ie.resetStore());case 7:case"end":return e.stop()}},e)}));return function(n,t){return e.apply(this,arguments)}}(),de=function(e){if(console.log("error",e),e.graphQLErrors.length>0)R(e.graphQLErrors[0].message),setTimeout(function(){R(null)},1e4);else if(e.networkError){var n=e.networkError.result.errors;n&&n.length>0&&(R(n[0].message),setTimeout(function(){R(null)},1e4))}},me=(Object(f.a)(B,{onError:de,update:function(e,n){console.log("add points response",n);var t=e.readQuery({query:M,variables:{roundId:c}});console.log("data in store before points update",t.allPoints);var r=n.data.addPoints;console.log("added point",r);var a=r.filter(function(e){return e.roundId===c}).map(function(e){return e.id}),o=t.allPoints.filter(function(e){return a.indexOf(e.id)<0}).concat(r);console.log("store after",o),ie.writeQuery({query:M,variables:{roundId:c},data:{allPoints:o}})}}),Object(f.a)(A,{onError:de,update:function(e,n){console.log("add point response",n);var t=e.readQuery({query:M,variables:{roundId:c}});console.log("data in store before point update",t.allPoints);var r=n.data.addPoint;console.log("added point",r);var a=t.allPoints.filter(function(e){return e.id!==r.id}).concat(r);console.log("store after",a),ie.writeQuery({query:M,variables:{roundId:c},data:{allPoints:a}})}})),fe=Object(f.a)(Y,{onError:de,update:function(e,n){var t=n.data.deleteLastTrack;if(console.log("deleted track index",t),t>-1){var r=e.readQuery({query:M,variables:{roundId:c}});console.log("points before deletion",r.allPoints);var a=r.allPoints.filter(function(e){return e.trackIndex!==t});console.log("filtered",a),ie.writeQuery({query:M,variables:{roundId:c},data:{allPoints:a}}),V>t-1&&W(t-1);var o=e.readQuery({query:M,variables:{roundId:c}});console.log("data in store after deletion",o.allPoints,"track index now",V)}}}),pe=(Object(f.a)(H,{onError:de,update:function(e,n){var t=e.readQuery({query:M,variables:{roundId:c}});console.log("data in store before new track push",t.allPoints),console.log("new track response",n.data);var r=n.data.addNewTrack;if(console.log("returned data",r),r&&r.length>0){for(var a=t.allPoints,o=0;o<r.length;o++)a.push(r[o]);console.log("new points",a),ie.writeQuery({query:M,variables:{roundId:c},data:{allPoints:a}}),console.log("new track index",r[0].trackIndex),W(r[0].trackIndex),t=e.readQuery({query:M,variables:{roundId:c}}),console.log("data in store after new track push",t)}}}),Object(f.a)(z,{onError:de,update:function(e,n){console.log("add round response",n);var t=e.readQuery({query:J});console.log("data in store before round update",t.allRounds);var r=n.data.addRound;console.log("added round",r);var a=t.allRounds.filter(function(e){return e.id!==r.id}).concat(r);console.log("store after",a),ie.writeQuery({query:J,data:{allRounds:a}})}})),be=Object(f.a)(D,{onError:de}),ve=function(e,n,a,o){var l={roundId:e,userId:n,trackNumber:a,points:o};console.log("add point",l);var u=t.filter(function(t){return t.roundId!==e||t.userId!==n||t.trackNumber!==a});console.log("filtered local storage plus addd points",u.concat(l)),r(u.concat(l))},ge=function(){var e=Object(s.a)(i.a.mark(function e(){var n,t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=w.users,console.log("add new track to round and trackindex",w.id,V,"for users",n),t=0;t<n.length;t++)ve(c,n[t].id,V,3);return e.abrupt("return");case 6:e.sent.data;case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),Ee=function(){var e=Object(s.a)(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete last track"),e.prev=1,e.next=4,fe({variables:{roundId:c}});case 4:n=e.sent,console.log("response",n.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),de(e.t0);case 11:case"end":return e.stop()}},e,null,[[1,8]])}));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=Object(s.a)(i.a.mark(function e(n,t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me({variables:{points:n,trackIndex:V,userId:t,roundId:c}});case 3:e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),de(e.t0);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(n,t){return e.apply(this,arguments)}}(),Ie=Object(p.a)(U),he=Object(p.a)(F,{skip:!1}),ye=Object(p.a)(M,{skip:!c,variables:{roundId:c}}),we=Object(p.a)(J,{skip:!1}),Oe=function(){var e=Object(s.a)(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("start new round",S.name,$.map(function(e){return e.username})),e.next=3,pe({variables:{userIds:$.map(function(e){return e.id}),locationId:S.id}});case 3:n=e.sent,console.log("response",n),L(null),N([]),O(n.data.addRound),I(n.data.addRound.id);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return o.a.createElement(b.a,null,_&&o.a.createElement("div",{className:"ui secondary menu"},o.a.createElement("div",{className:"item",onClick:function(){ce("main"),console.log("main")}},"main"),c?o.a.createElement("div",{className:"item",onClick:function(){ce("round"),console.log("continue round")}},"continue round"):o.a.createElement("div",{className:"item",onClick:function(){ce("round"),console.log("new round")}},"new round"),o.a.createElement("div",{className:"item"},re," logged in"),o.a.createElement("div",{className:"item",onClick:function(){ce(null),console.log("logout"),ee(null),ae(null),localStorage.clear(),ie.resetStore()}},"logout")),q&&o.a.createElement("div",null,"errorMessage"),!_&&o.a.createElement(k,{doLogin:se,show:!0,handleError:de}),_&&!c&&o.a.createElement(g,{allLocationsQuery:Ie,allUsersQuery:he,handleLocationClick:function(e){return function(){console.log("location clicked",e),L(e===S?null:e)}},handleUserClick:function(e){return function(){console.log("user clicked",e),$.includes(e)?N($.filter(function(n){return n!==e})):N($.concat(e))}},currentLocation:S,currentUsers:$,startNewRound:Oe,show:"round"===ue}),_&&o.a.createElement(E,{result:we,setRound:function(e){console.log("round",e),O(e),I(e.id),W(-1)},show:"main"===ue}),_&&c&&o.a.createElement(v,{allPointsQuery:ye,round:w,addNewTrack:ge,updatePoint:ke,deleteLastTrack:Ee,changeTrack:function(e){W(e)},trackIndex:V,finishRound:function(){console.log("finish round"),O(null),I(null),N([]),L(null),ce("main")},show:"round"===ue}),o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement("em",null,"Frisbeegolf app, Juho Taipale 2019")))},K=t(82),V=t(17),W=t(84),X=t(83),Z=t(81),_=t(7),ee=t(80),ne=t(2),te=window.location.origin.replace(/^http/,"ws"),re="".concat(te,"/graphql");console.log("websocket uri",re);var ae=new ee.a({uri:re,options:{reconnect:!0}}),oe=Object(W.a)({uri:"/graphql"}),le=Object(Z.a)(function(e,n){var t=n.headers,a=localStorage.getItem("loggedToken");return{headers:Object(r.a)({},t,{authorization:a?"bearer ".concat(a):null})}}),ue=Object(_.d)(function(e){var n=e.query,t=Object(ne.l)(n),r=t.kind,a=t.operation;return"OperationDefinition"===r&&"subscription"===a},ae,le.concat(oe)),ce=new V.a({link:ue,cache:new X.a});u.a.render(o.a.createElement(K.a,{client:ce},o.a.createElement(m.a,{client:ce},o.a.createElement(G,null))),document.getElementById("root"))},99:function(e,n,t){e.exports=t(212)}},[[99,1,2]]]);
//# sourceMappingURL=main.310da3bb.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{212:function(e,n,t){"use strict";t.r(n);var r=t(85),a=t(0),l=t.n(a),o=t(71),u=t.n(o),c=t(9),i=t.n(c),s=t(17),d=t(12),m=t(38),f=t(214),p=t(216),b=t(215),v=function(e){if(!e.show)return null;if(console.log("round",e.round),!e.round)return console.log("no round chosen"),null;if(e.allPointsQuery.loading)return console.log("loading"),l.a.createElement("div",null,"loading...");if(e.allPointsQuery.error)return console.log("error",e.allPointsQuery.error),l.a.createElement("div",null,"error...");console.log("all points",e.allPointsQuery.data.allPoints),console.log("players ",e.round.users);var n=e.round.users,t=e.trackIndex,r=e.allPointsQuery.data.allPoints,a=e.round,o=n.slice(),u=function(e){var n=-1;return e.forEach(function(e){n<e&&(n=e)}),n}(r.map(function(e){return e.trackIndex}));if(-1===t)return e.changeTrack(u),null;var c=function(n){return function(){e.changeTrack(n)}},i=function(n,t){return function(){n>-1&&e.updatePoint(n,t.id)}};o.sort(function(e,n){for(var a=function(t){var a=r.filter(function(e){return e.trackIndex===t}),l=a.filter(function(n){return n.user.id===e.id}),o=a.filter(function(e){return e.user.id===n.id});if(0===l.length||0===o.length)return{v:0};var u=l[0].points,c=o[0].points;return u>c?{v:1}:u<c?{v:-1}:void 0},l=t;l>=0;l--){var o=a(l);if("object"===typeof o)return o.v}return 0}),console.log("order",o);u+1===t&&e.addNewTrack();for(var s=[],d=0;d<u+1;d++)s.push(l.a.createElement("th",{key:d},d+1));return l.a.createElement("div",{className:"App"},l.a.createElement("div",null,l.a.createElement("h3",null,a.location.name),l.a.createElement("h3",null,l.a.createElement("button",{text:"-",onClick:c(t-1)},"-"),"Track ",t+1,l.a.createElement("button",{text:"+",onClick:c(t+1)},"+")),l.a.createElement("table",{className:"ui celled table"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"order"),l.a.createElement("th",null,"player"),s,l.a.createElement("th",null,"total"))),l.a.createElement("tbody",null,n.map(function(e){var n=r.filter(function(n){return n.user.id===e.id});if(n){n.sort(function(e,n){return e.trackIndex-n.trackIndex});var a=0===n.length?0:n.map(function(e){return e.points}).reduce(function(e,n){return e+n});return l.a.createElement("tr",{key:e.id},l.a.createElement("td",{key:"order"},function(e){for(var n=0;n<o.length;n++)if(e===o[n])return n+1+".";return"err"}(e)),l.a.createElement("td",{key:e.username},e.username),n.map(function(n){return n.trackIndex===t?l.a.createElement("td",{key:n.trackIndex+e.id},l.a.createElement("b",null,l.a.createElement("button",{className:"ui button",onClick:i(n.points-1,n.user)},"-"),n.points,l.a.createElement("button",{className:"ui button",onClick:i(n.points+1,n.user)},"+"))):l.a.createElement("td",{key:n.trackIndex+e.id},n.points)}),l.a.createElement("td",null,a))}return l.a.createElement("tr",null,l.a.createElement("td",null,"no plays"))})))),l.a.createElement("div",null,l.a.createElement("button",{className:"ui button",text:"delete last track",onClick:function(){e.deleteLastTrack()}},"delete last track")),l.a.createElement("div",null,l.a.createElement("button",{className:"ui button",text:"finish round",onClick:function(){e.finishRound()}},"finnish round")),!1)},E=function(e){if(!e.show)return null;if(e.allLocationsQuery.loading||e.allUsersQuery.loading)return console.log("loading"),l.a.createElement("div",null,"loading...");if(e.allLocationsQuery.error||e.allUsersQuery.error)return console.log("errors",e.allUsersQuery.error,e.allLocationsQuery.error),l.a.createElement("div",null,"error...");var n=e.allLocationsQuery.data.allLocations,t=e.allUsersQuery.data.allUsers,r=e.currentLocation,a=e.currentUsers;return r?l.a.createElement("div",null,l.a.createElement("h3",null,"New round"),l.a.createElement("div",{onClick:e.handleLocationClick(r)},r.name),l.a.createElement("div",null,l.a.createElement("table",{className:"ui celled table"},l.a.createElement("thead",null,l.a.createElement("tr",{key:"header"},l.a.createElement("th",null,"selected players"))),l.a.createElement("tbody",null,l.a.createElement("tr",null,a.map(function(n){return l.a.createElement("td",{key:n.id,onClick:e.handleUserClick(n)},n.username)}))))),a.length>0&&r&&l.a.createElement("div",null,l.a.createElement("form",{onSubmit:function(n){console.log("start new round with",r,a),n.preventDefault(),e.startNewRound()}},l.a.createElement("button",{className:"ui button",type:"submit"},"start"))),l.a.createElement("div",null,l.a.createElement("table",{className:"ui celled table"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"all players"))),l.a.createElement("tbody",null,t.map(function(n){return l.a.createElement("tr",{key:n.id},l.a.createElement("td",{onClick:e.handleUserClick(n)},n.username))}))))):l.a.createElement("div",null,l.a.createElement("h3",null,"Select location"),l.a.createElement("div",null,l.a.createElement("table",{className:"ui celled table"},l.a.createElement("thead",null,l.a.createElement("tr",{key:"header"},l.a.createElement("th",null,"locations"))),l.a.createElement("tbody",null,n.map(function(n){return l.a.createElement("tr",{key:n.id},l.a.createElement("td",{onClick:e.handleLocationClick(n)},n.name))})))))},g=function(e){if(!e.show)return null;if(e.result.loading)return l.a.createElement("div",null,"loading...");if(e.result.error)return console.log("error",e.result.error),l.a.createElement("div",null,"error...");var n=function(n){return function(){console.log("round clicked",n),e.setRound(n)}},t=e.result.data.allRounds;return t.sort(function(e,n){return n.date-e.date}),console.log("all rounds",t),t?l.a.createElement("div",null,l.a.createElement("table",{className:"ui celled table"},l.a.createElement("thead",null,l.a.createElement("tr",{key:"header"},l.a.createElement("th",null,"location"),l.a.createElement("th",null,"date"),l.a.createElement("th",{colSpan:"99"},"players"))),l.a.createElement("tbody",null,t.map(function(e){var t=new Date(e.date),r=t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return l.a.createElement("tr",{onClick:n(e),key:e.id},l.a.createElement("td",null,e.location.name),l.a.createElement("td",null,r),e.users.map(function(e){return l.a.createElement("td",{key:e.username},e.username)}))})))):null},k=function(e){var n=Object(a.useState)(""),t=Object(d.a)(n,2),r=t[0],o=t[1],u=Object(a.useState)(""),c=Object(d.a)(u,2),m=c[0],f=c[1];if(!e.show)return null;var p=function(){var n=Object(s.a)(i.a.mark(function n(t){return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.preventDefault(),e.doLogin(r,m);case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}();return l.a.createElement("div",{className:"login"},l.a.createElement("h2",null,"Login to application"),l.a.createElement("form",{onSubmit:p,className:"ui form"},l.a.createElement("div",{className:"field"},l.a.createElement("label",null,"Username"),l.a.createElement("input",{id:"username",type:"text",placeholder:"username",value:r,onChange:function(e){o(e.target.value)}})),l.a.createElement("div",{className:"field"},l.a.createElement("label",null,"Password"),l.a.createElement("input",{id:"password",type:"password",placeholder:"password",value:m,onChange:function(e){f(e.target.value)}})),l.a.createElement("button",{className:"ui button",type:"submit"},"login")))},h=t(10),y=t(11),I=t.n(y);function w(){var e=Object(h.a)(["\nmutation deleteLastTrack($roundId: ID!){\n  deleteLastTrack(\n    roundId: $roundId\n  )\n}\n"]);return w=function(){return e},e}function j(){var e=Object(h.a)(["\nmutation addNewTrack($roundId: ID!){\n  addNewTrack(\n    roundId: $roundId\n  ){\n    trackIndex,\n    user{id, username},\n    round{id},\n    points,\n    id\n  }\n}\n"]);return j=function(){return e},e}function O(){var e=Object(h.a)(["\n  mutation addPoint($roundId: ID!, $trackIndex:Int!, $userId: ID!, $points: Int!){\n    addPoint(\n      roundId: $roundId,\n      userId: $userId,\n      trackIndex: $trackIndex,\n      points: $points\n    ){\n      trackIndex,\n      user{id, username},\n      round{id},\n      points,\n      id\n    }\n  }\n"]);return O=function(){return e},e}function x(){var e=Object(h.a)(["\n  mutation createPlay($roundId: ID!, $playNumber:Int!){\n    addPlay(\n      roundId: $roundId,\n      playNumber: $playNumber\n    ){\n      id\n    }\n  }\n"]);return x=function(){return e},e}function N(){var e=Object(h.a)(["\n  mutation createRound($locationId: ID!, $userIds: [ID!]!){\n    addRound(\n      locationId: $locationId\n      userIds: $userIds\n    ){\n      location{\n        name\n        id\n      }\n      users{\n        username\n        id\n      }\n      date\n      id\n    }\n  }\n"]);return N=function(){return e},e}function Q(){var e=Object(h.a)(["\n  mutation createLocation($name: String!){\n    addLocation(\n      name: $name\n    ){\n      id, name\n    }\n  }\n"]);return Q=function(){return e},e}function $(){var e=Object(h.a)(["\n{\n  me{\n    username\n    id\n  }\n}\n"]);return $=function(){return e},e}function P(){var e=Object(h.a)(["\nquery {\n  allUsers{\n    username,\n    id\n  }\n}\n"]);return P=function(){return e},e}function S(){var e=Object(h.a)(["\n  query ($roundId: ID!) {\n    allPoints(\n      roundId: $roundId\n    ){\n    trackIndex,\n    user{id, username},\n    round{id},\n    points,\n    id\n    }\n  }\n"]);return S=function(){return e},e}function L(){var e=Object(h.a)(["\n{\n  allRounds {\n    users{username, id}\n    location{name, id}\n    date\n    id\n  }\n}\n"]);return L=function(){return e},e}function C(){var e=Object(h.a)(["\n{\n  allLocations {\n    name\n    id\n  }\n}  \n"]);return C=function(){return e},e}function T(){var e=Object(h.a)(["\n{\n  me {\n    username\n    id\n    friends{username, id}\n  }\n}\n"]);return T=function(){return e},e}function R(){var e=Object(h.a)(["\nmutation login($username: String!, $password: String! ){\n  login(username: $username, password: $password){\n    token\n    username\n  }\n  \n}\n"]);return R=function(){return e},e}var q=I()(R()),D=(I()(T()),I()(C())),U=I()(L()),J=I()(S()),M=I()(P()),F=(I()($()),I()(Q()),I()(N())),z=(I()(x()),I()(O())),A=I()(j()),B=I()(w());var H=function(){var e=Object(a.useState)(null),n=Object(d.a)(e,2),t=n[0],r=n[1],o=Object(a.useState)(null),u=Object(d.a)(o,2),c=u[0],h=u[1],y=Object(a.useState)([]),I=Object(d.a)(y,2),w=I[0],j=I[1],O=Object(a.useState)(null),x=Object(d.a)(O,2),N=x[0],Q=x[1],$=Object(a.useState)(null),P=Object(d.a)($,2),S=P[0],L=P[1],C=Object(a.useState)(0),T=Object(d.a)(C,2),R=T[0],H=T[1],Y=Object(a.useState)(null),G=Object(d.a)(Y,2),K=G[0],V=G[1],W=Object(a.useState)(null),X=Object(d.a)(W,2),Z=X[0],_=X[1],ee=Object(a.useState)("main"),ne=Object(d.a)(ee,2),te=ne[0],re=ne[1],ae=Object(m.b)();Object(a.useEffect)(function(){var e=localStorage.getItem("username"),n=localStorage.getItem("token");console.log("restore logged user",e,n),V(n),_(e)},[]);var le=function(){var e=Object(s.a)(i.a.mark(function e(n,t){var r,a,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de({variables:{username:n,password:t}});case 2:r=e.sent,a=r.data.login.token,l=r.data.login.username,console.log("login token and username",a,l),a&&(V(a),_(n),localStorage.setItem("username",l),localStorage.setItem("token",a),re("main"),ae.resetStore());case 7:case"end":return e.stop()}},e)}));return function(n,t){return e.apply(this,arguments)}}(),oe=function(e){if(console.log("error",e),e.graphQLErrors.length>0)L(e.graphQLErrors[0].message),setTimeout(function(){L(null)},1e4);else if(e.networkError){var n=e.networkError.result.errors;n&&n.length>0&&(L(n[0].message),setTimeout(function(){L(null)},1e4))}},ue=Object(f.a)(z,{onError:oe,update:function(e,n){console.log("add point response",n);var r=e.readQuery({query:J,variables:{roundId:t}});console.log("data in store before point update",r.allPoints);var a=n.data.addPoint;console.log("added point",a);var l=r.allPoints.filter(function(e){return e.id!==a.id}).concat(a);console.log("store after",l),ae.writeQuery({query:J,variables:{roundId:t},data:{allPoints:l}})}}),ce=Object(f.a)(B,{onError:oe,update:function(e,n){var r=n.data.deleteLastTrack;if(console.log("deleted track index",r),r>-1){var a=e.readQuery({query:J,variables:{roundId:t}});console.log("points before deletion",a.allPoints);var l=a.allPoints.filter(function(e){return e.trackIndex!==r});console.log("filtered",l),ae.writeQuery({query:J,variables:{roundId:t},data:{allPoints:l}}),R>r-1&&H(r-1);var o=e.readQuery({query:J,variables:{roundId:t}});console.log("data in store after deletion",o.allPoints,"track index now",R)}}}),ie=Object(f.a)(A,{onError:oe,update:function(e,n){var r=e.readQuery({query:J,variables:{roundId:t}});console.log("data in store before new track push",r.allPoints),console.log("new track response",n.data);var a=n.data.addNewTrack;if(console.log("returned data",a),a&&a.length>0){for(var l=r.allPoints,o=0;o<a.length;o++)l.push(a[o]);console.log("new points",l),ae.writeQuery({query:J,variables:{roundId:t},data:{allPoints:l}}),console.log("new track index",a[0].trackIndex),H(a[0].trackIndex),r=e.readQuery({query:J,variables:{roundId:t}}),console.log("data in store after new track push",r)}}}),se=Object(f.a)(F,{onError:oe,update:function(e,n){console.log("add round response",n);var t=e.readQuery({query:U});console.log("data in store before round update",t.allRounds);var r=n.data.addRound;console.log("added round",r);var a=t.allRounds.filter(function(e){return e.id!==r.id}).concat(r);console.log("store after",a),ae.writeQuery({query:U,data:{allRounds:a}})}}),de=Object(f.a)(q,{onError:oe}),me=function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie({variables:{roundId:t}});case 2:e.sent.data;case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=Object(s.a)(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete last track"),e.prev=1,e.next=4,ce({variables:{roundId:t}});case 4:n=e.sent,console.log("response",n.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),oe(e.t0);case 11:case"end":return e.stop()}},e,null,[[1,8]])}));return function(){return e.apply(this,arguments)}}(),pe=function(){var e=Object(s.a)(i.a.mark(function e(n,r){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue({variables:{points:n,trackIndex:R,userId:r,roundId:t}});case 3:e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),oe(e.t0);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(n,t){return e.apply(this,arguments)}}(),be=Object(p.a)(D),ve=Object(p.a)(M,{skip:!1}),Ee=Object(p.a)(J,{skip:!t,variables:{roundId:t}}),ge=Object(p.a)(U,{skip:!1}),ke=function(){var e=Object(s.a)(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("start new round",N.name,w.map(function(e){return e.username})),e.next=3,se({variables:{userIds:w.map(function(e){return e.id}),locationId:N.id}});case 3:n=e.sent,console.log("response",n),Q(null),j([]),h(n.data.addRound),r(n.data.addRound.id);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return l.a.createElement(b.a,null,K&&l.a.createElement("div",{className:"ui secondary menu"},l.a.createElement("div",{className:"item",onClick:function(){re("main"),console.log("main")}},"main"),t?l.a.createElement("div",{className:"item",onClick:function(){re("round"),console.log("continue round")}},"continue round"):l.a.createElement("div",{className:"item",onClick:function(){re("round"),console.log("new round")}},"new round"),l.a.createElement("div",{className:"item"},Z," logged in"),l.a.createElement("div",{className:"item",onClick:function(){re(null),console.log("logout"),V(null),_(null),localStorage.clear(),ae.resetStore()}},"logout")),S&&l.a.createElement("div",null,"errorMessage"),!K&&l.a.createElement(k,{doLogin:le,show:!0,handleError:oe}),K&&!t&&l.a.createElement(E,{allLocationsQuery:be,allUsersQuery:ve,handleLocationClick:function(e){return function(){console.log("location clicked",e),Q(e===N?null:e)}},handleUserClick:function(e){return function(){console.log("user clicked",e),w.includes(e)?j(w.filter(function(n){return n!==e})):j(w.concat(e))}},currentLocation:N,currentUsers:w,startNewRound:ke,show:"round"===te}),K&&l.a.createElement(g,{result:ge,setRound:function(e){console.log("round",e),h(e),r(e.id),H(-1)},show:"main"===te}),K&&t&&l.a.createElement(v,{allPointsQuery:Ee,round:c,addNewTrack:me,updatePoint:pe,deleteLastTrack:fe,changeTrack:function(e){H(e)},trackIndex:R,finishRound:function(){console.log("finish round"),h(null),r(null),j([]),Q(null),re("main")},show:"round"===te}),l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement("em",null,"Frisbeegolf app, Juho Taipale 2019")))},Y=t(82),G=t(16),K=t(84),V=t(83),W=t(81),X=t(7),Z=t(80),_=t(2),ee=window.location.origin.replace(/^http/,"ws"),ne="".concat(ee,"/graphql");console.log("websocket uri",ne);var te=new Z.a({uri:ne,options:{reconnect:!0}}),re=Object(K.a)({uri:"/graphql"}),ae=Object(W.a)(function(e,n){var t=n.headers,a=localStorage.getItem("loggedToken");return{headers:Object(r.a)({},t,{authorization:a?"bearer ".concat(a):null})}}),le=Object(X.d)(function(e){var n=e.query,t=Object(_.l)(n),r=t.kind,a=t.operation;return"OperationDefinition"===r&&"subscription"===a},te,ae.concat(re)),oe=new G.a({link:le,cache:new V.a});u.a.render(l.a.createElement(Y.a,{client:oe},l.a.createElement(m.a,{client:oe},l.a.createElement(H,null))),document.getElementById("root"))},99:function(e,n,t){e.exports=t(212)}},[[99,1,2]]]);
//# sourceMappingURL=main.4f1a247b.chunk.js.map
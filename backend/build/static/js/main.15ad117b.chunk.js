(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{174:function(e,n,t){e.exports=t(365)},182:function(e,n){},184:function(e,n){},217:function(e,n){},218:function(e,n){},365:function(e,n,t){"use strict";t.r(n);var a=t(69),r=t(1),o=t.n(r),l=t(150),u=t.n(l),c=t(11),i=t.n(c),s=t(10),d=t(21),m=t(370),f=(t(50),function(e){if(!e.show)return null;if(e.meQuery.loading)return o.a.createElement("div",null,"loading...");if(e.meQuery.error)return console.log("error",e.meQuery.error),o.a.createElement("div",null,"error...");var n=function(n){e.setPage(n)},t=e.meQuery.data.me,a=e.currentRoundId;return o.a.createElement("div",{className:"ui secondary menu"},o.a.createElement("div",{className:"item pointer",onClick:function(){n("main"),console.log("main")}},"main"),a?o.a.createElement("div",{className:"item pointer",onClick:function(){n("round"),console.log("continue round")}},"continue round"):o.a.createElement("div",{className:"item pointer",onClick:function(){n("round"),console.log("new round")}},"new round"),o.a.createElement("div",{className:"item"},t.username," ",t.admin?"(admin) ":"","logged in"),o.a.createElement("div",{className:"item pointer",onClick:function(){n(null),e.doLogout()}},"logout"))}),p=function(e){if(!e.show)return null;if(!e.round)return console.log("no round chosen"),null;if(e.allPointsQuery.loading)return o.a.createElement("div",null,"loading...");if(e.allPointsQuery.error)return console.log("error",e.allPointsQuery.error),o.a.createElement("div",null,"error...");var n=e.savedState,t=e.uploadingPoints,a=n||t,r=e.round.users,l=e.trackIndex,u=e.allPointsQuery.data.allPoints,c=e.round,i=r.slice(),s=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,t=n;return e.forEach((function(e){t<e&&(t=e)})),t}(u.map((function(e){return e.trackIndex})),-1);if(-1===l&&s>-1)return e.changeTrack(s),null;0===u.length&&(e.addNewTrack(),e.changeTrack(0));var d=function(n){return function(){s+1===n&&e.addNewTrack(),e.changeTrack(n)}},m=function(n,t){return function(){n>-1&&e.updatePoint(n,t.id)}};i.sort((function(e,n){for(var t=function(t){var a=u.filter((function(e){return e.trackIndex===t})),r=a.filter((function(n){return n.user.id===e.id})),o=a.filter((function(e){return e.user.id===n.id}));if(0===r.length||0===o.length)return{v:0};var l=r[0].points,c=o[0].points;return l>c?{v:1}:l<c?{v:-1}:void 0},a=l;a>=0;a--){var r=t(a);if("object"===typeof r)return r.v}return 0}));for(var f=[],p=0;p<s+1;p++)f.push(o.a.createElement("th",{key:p},p+1));return o.a.createElement("div",{className:"App"},o.a.createElement("div",null,o.a.createElement("h3",null,c.location.name),o.a.createElement("h3",null,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"ui centered grid"},o.a.createElement("button",{onClick:d(l-1)},"<"),"Track ",l+1,o.a.createElement("button",{onClick:d(l+1)},">")))),o.a.createElement("br",null),o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"order"),o.a.createElement("th",null,o.a.createElement("div",{className:"center"},"player")),f,o.a.createElement("th",null,"total"))),o.a.createElement("tbody",null,r.map((function(e){var n=u.filter((function(n){return n.user.id===e.id}));if(n){n.sort((function(e,n){return e.trackIndex-n.trackIndex}));var t=0===n.length?0:n.map((function(e){return e.points})).reduce((function(e,n){return e+n}));return o.a.createElement("tr",{key:e.id},o.a.createElement("td",{key:"order"},function(e){for(var n=0;n<i.length;n++)if(e===i[n])return n+1+".";return"err"}(e)),o.a.createElement("td",{key:e.username},e.username),n.map((function(n){return n.trackIndex===l?o.a.createElement("td",{key:n.trackIndex+e.id},o.a.createElement("strong",null,o.a.createElement("button",{className:"ui button",onClick:m(n.points-1,n.user)},"-"),n.points,o.a.createElement("button",{className:"ui button",onClick:m(n.points+1,n.user)},"+"))):o.a.createElement("td",{key:n.trackIndex+e.id},n.points)})),o.a.createElement("td",null,t))}return o.a.createElement("tr",null,o.a.createElement("td",null,"no plays"))}))))),o.a.createElement("br",null),o.a.createElement("div",{className:"ui centered grid"},n&&o.a.createElement("div",null,"saved state"),!n&&o.a.createElement("div",{className:"error"},o.a.createElement("strong",null,"unsaved state"))),o.a.createElement("br",null),o.a.createElement("div",{className:"row"},o.a.createElement("button",{className:"ui button",text:"delete last track",onClick:function(){e.deleteLastTrack()}},"delete last track"),o.a.createElement("button",{className:"ui button",text:"finish round",onClick:function(){e.finishRound()}},"finnish round"),!a&&o.a.createElement("button",{className:"ui button",disabled:a,onClick:function(){e.uploadPoints()}},"upload points")))},b=function(e){var n=Object(r.useState)(""),t=Object(s.a)(n,2),a=t[0],l=t[1];if(!e.show)return null;return o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("input",{value:a,onChange:function(e){var n=e.target;return l(n.value)}})),o.a.createElement("button",{className:"ui button",onClick:function(){e.addNewLocation(a),l("")}},"add new location"))},E=function(e){if(!e.show)return null;var n=e.allLocationsQuery.data.allLocations,t=e.allUsersQuery.data.allUsers,a=e.currentLocation,r=e.currentPlayers;return e.allLocationsQuery.loading||e.allUsersQuery.loading?o.a.createElement("div",null,"loading..."):e.allLocationsQuery.error||e.allUsersQuery.error?o.a.createElement("div",null,"error..."):a?o.a.createElement("div",null,o.a.createElement("h3",null,"New round"),o.a.createElement("div",{onClick:e.handleLocationClick(a)},a.name),o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",{key:"header"},o.a.createElement("th",null,"selected players"))),o.a.createElement("tbody",null,o.a.createElement("tr",null,r.map((function(n){return o.a.createElement("td",{className:"ui button",key:n.id,onClick:e.handleUserClick(n)},n.username)})))))),r.length>0&&a&&o.a.createElement("div",null,o.a.createElement("form",{onSubmit:function(n){console.log("start new round with",a,r),n.preventDefault(),e.startNewRound()}},o.a.createElement("button",{className:"ui button",type:"submit"},"start"))),o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"all players"))),o.a.createElement("tbody",null,t.map((function(n){return o.a.createElement("tr",{key:n.id},o.a.createElement("td",{className:"ui button",onClick:e.handleUserClick(n)},n.username))})))))):o.a.createElement("div",null,o.a.createElement("h3",null,"Select location"),o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",{key:"header"},o.a.createElement("th",null,"locations"))),o.a.createElement("tbody",null,n.map((function(n){return o.a.createElement("tr",{key:n.id},o.a.createElement("td",{className:"ui button",onClick:e.handleLocationClick(n)},n.name))}))))),o.a.createElement(b,{show:!0,addNewLocation:e.addNewLocation}))},v=function(e){if(!e.show)return null;if(e.allRoundsQuery.loading)return o.a.createElement("div",null,"loading...");if(e.allRoundsQuery.error)return console.log("error",e.allRoundsQuery.error),o.a.createElement("div",null,"error...");var n=function(n){return function(){e.setRound(n)}},t=e.allRoundsQuery.data.allRounds;return t.sort((function(e,n){return n.date-e.date})),t?o.a.createElement("div",null,o.a.createElement("table",{className:"ui celled table"},o.a.createElement("thead",null,o.a.createElement("tr",{key:"header"},o.a.createElement("th",null,"location"),o.a.createElement("th",null,"date"),o.a.createElement("th",null,"players"),o.a.createElement("th",null,"delete"))),o.a.createElement("tbody",null,t.map((function(t){for(var a=new Date(t.date),r=a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),l=[],u=0;u<t.users.length;u++){var c=t.users[u],i=t.totals?t.totals[u]:null;l.push(c.username.toString()+(i?":"+i.toString():""))}var s=l.join("\n");return o.a.createElement("tr",{key:t.id},o.a.createElement("td",{className:"pointer",onClick:n(t)},t.location.name),o.a.createElement("td",null,r),o.a.createElement("td",null,o.a.createElement("span",null,s)),o.a.createElement("td",null,o.a.createElement("button",{className:"ui button",onClick:function(){window.confirm("Are you sure you wish to delete this round?")&&function(n){e.deleteRound(n)}(t)}},"X")))}))))):null},h=function(e){var n=Object(r.useState)(""),t=Object(s.a)(n,2),a=t[0],l=t[1],u=Object(r.useState)(""),c=Object(s.a)(u,2),d=c[0],m=c[1];if(!e.show)return null;return o.a.createElement("div",{className:"login"},o.a.createElement("h2",null,"Login to application"),o.a.createElement("form",{onSubmit:function(n){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.doLogin(a,d);case 2:case"end":return t.stop()}}))},className:"ui form"},o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"Username"),o.a.createElement("input",{id:"username",type:"text",placeholder:"username",value:a,onChange:function(e){l(e.target.value)}})),o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"Password"),o.a.createElement("input",{id:"password",type:"password",placeholder:"password",value:d,onChange:function(e){m(e.target.value)}})),o.a.createElement("button",{className:"ui button",type:"submit"},"login")))},y=t(151),g=t.n(y),k=t(19),I=t(20),w=t.n(I);function j(){var e=Object(k.a)(["\nsubscription($roundId: ID!){\n  pointAdded(roundId: $roundId) {\n    trackIndex,\n    user{id},\n    round{id},\n    points,\n    id\n  }\n}\n"]);return j=function(){return e},e}function O(){var e=Object(k.a)(["\n  mutation addCachedPoints($roundId: ID!, $pointIds: [ID!]!, $userIds: [ID!]!, $trackIndexes:[Int!]!, $points: [Int!]!){\n    addCachedPoints(\n      roundId: $roundId,\n      pointIds: $pointIds,\n      userIds: $userIds,\n      trackIndexes: $trackIndexes,\n      points: $points\n    ){\n      trackIndex,\n      user{id},\n      round{id},\n      points,\n      id\n    }\n  }\n"]);return O=function(){return e},e}function x(){var e=Object(k.a)(["\n  mutation createPlay($roundId: ID!, $playNumber:Int!){\n    addPlay(\n      roundId: $roundId,\n      playNumber: $playNumber\n    ){\n      id\n    }\n  }\n"]);return x=function(){return e},e}function N(){var e=Object(k.a)(["\n  mutation removeRound($roundId: ID!){\n    deleteRound(\n      roundId: $roundId\n    ){\n      id\n    }\n  }\n"]);return N=function(){return e},e}function Q(){var e=Object(k.a)(["\n  mutation createRound($locationId: ID!, $userIds: [ID!]!){\n    addRound(\n      locationId: $locationId\n      userIds: $userIds\n    ){\n      location{\n        name\n        id\n      }\n      users{\n        username\n        id\n      }\n      date\n      id\n    }\n  }\n"]);return Q=function(){return e},e}function P(){var e=Object(k.a)(["\n  mutation createLocation($name: String!){\n    addLocation(\n      name: $name\n    ){\n      id, name\n    }\n  }\n"]);return P=function(){return e},e}function S(){var e=Object(k.a)(["\nquery{\n  me{\n    admin\n    username\n    id\n  }\n}\n"]);return S=function(){return e},e}function R(){var e=Object(k.a)(["\nquery {\n  allUsers{\n    username,\n    id\n  }\n}\n"]);return R=function(){return e},e}function C(){var e=Object(k.a)(["\n  query ($roundId: ID!) {\n    allPoints(\n      roundId: $roundId\n    ){\n    trackIndex,\n    user{id},\n    round{id},\n    points,\n    id\n    }\n  }\n"]);return C=function(){return e},e}function L(){var e=Object(k.a)(["\n{\n  allRounds {\n    users{username, id}\n    location{name, id}\n    date\n    id\n  }\n}\n"]);return L=function(){return e},e}function $(){var e=Object(k.a)(["\n{\n  allLocations {\n    name\n    id\n  }\n}  \n"]);return $=function(){return e},e}function q(){var e=Object(k.a)(["\n{\n  me {\n    username\n    id\n    friends{username, id}\n  }\n}\n"]);return q=function(){return e},e}function T(){var e=Object(k.a)(["\nmutation login($username: String!, $password: String! ){\n  login(username: $username, password: $password){\n    token\n    username\n  }\n  \n}\n"]);return T=function(){return e},e}var D=w()(T()),U=(w()(q()),w()($())),_=w()(L()),A=w()(C()),J=w()(R()),B=w()(S()),F=w()(P()),M=w()(Q()),Y=w()(N()),z=(w()(x()),w()(O())),H=(w()(j()),function(e){var n,t=function(){console.log("You have been logged out"),e()},a=function(){n=setTimeout(t,36e5)};Object(r.useEffect)((function(){var e=["load","mousedown","click","scroll","keypress"],t=function(){n&&clearTimeout(n),a()};for(var r in e)window.addEventListener(e[r],t);a()}))}),X=function(e){var n=Object(r.useState)(null),t=Object(s.a)(n,2),l=t[0],u=t[1],c=Object(r.useState)(null),b=Object(s.a)(c,2),y=b[0],k=b[1],I=Object(r.useState)([]),w=Object(s.a)(I,2),j=w[0],O=w[1],x=Object(r.useState)(null),N=Object(s.a)(x,2),Q=N[0],P=N[1],S=Object(r.useState)(null),R=Object(s.a)(S,2),C=R[0],L=R[1],$=Object(r.useState)(0),q=Object(s.a)($,2),T=q[0],X=q[1],G=Object(r.useState)(null),K=Object(s.a)(G,2),V=K[0],W=K[1],Z=Object(r.useState)("main"),ee=Object(s.a)(Z,2),ne=ee[0],te=ee[1],ae=Object(d.a)(),re=Object(r.useState)(!0),oe=Object(s.a)(re,2),le=oe[0],ue=oe[1],ce=Object(r.useState)(!1),ie=Object(s.a)(ce,2),se=ie[0],de=ie[1];Object(r.useEffect)((function(){var e=localStorage.getItem("token");W(e)}),[]);var me=function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return W(null),localStorage.clear(),e.next=4,i.a.awrap(ae.resetStore());case 4:case"end":return e.stop()}}))};H(me),e.sessionTimeout&&(console.log("session time out received"),me());var fe=function(e){if(console.log("error",e),e.graphQLErrors.length>0)L(e.graphQLErrors[0].message),setTimeout((function(){L(null)}),7e3);else if(e.networkError){var n=e.networkError.result.errors;n&&n.length>0&&(L(n[0].message),setTimeout((function(){L(null)}),7e3))}},pe=Object(d.b)(z,{onError:fe,update:function(e,n){var t=n.data.addCachedPoints,a=e.readQuery({query:A,variables:{roundId:l}}).allPoints;ue(!0),t.length!==a.length?ue(!1):t.forEach((function(e){var n=!1;a.forEach((function(t){e.round.id!==t.round.id||e.user.id!==t.user.id||e.trackIndex!==t.trackIndex||e.points!==t.points||(n=!0)})),n||ue(!1)}))}}),be=Object(s.a)(pe,1)[0],Ee=Object(d.b)(M,{onError:fe,update:function(e,n){var t=e.readQuery({query:_});console.log("data in store before",t.allRounds);var a=n.data.addRound,r=t.allRounds.filter((function(e){return e.id!==a.id})).concat(a);console.log("added round",a),console.log("all rounds",r),ae.writeQuery({query:_,data:{allRounds:r}})}}),ve=Object(s.a)(Ee,1)[0],he=Object(d.b)(F,{onError:fe,update:function(e,n){var t=e.readQuery({query:U}),a=n.data.addLocation,r=t.allLocations.filter((function(e){return e.id!==a.id})).concat(a);ae.writeQuery({query:U,data:{allLocations:r}})}}),ye=Object(s.a)(he,1)[0],ge=Object(d.b)(Y,{onError:fe,update:function(e,n){var t=e.readQuery({query:_}),a=n.data.deleteRound,r=t.allRounds.filter((function(e){return e.id!==a.id}));ae.writeQuery({query:_,data:{allRounds:r}})}}),ke=Object(s.a)(ge,1)[0],Ie=Object(d.b)(D,{onError:fe,update:function(e,n){}}),we=Object(s.a)(Ie,1)[0],je=function(e,n,t,r){var o=ae.readQuery({query:A,variables:{roundId:e}}),l=o.allPoints.filter((function(e){return e.user.id===n&&e.trackIndex===t}));if(l.length>0){var u=l[0];ae.writeQuery({query:A,variables:{roundId:e},data:{allPoints:o.allPoints.filter((function(e){return e.id!==u.id})).concat(Object(a.a)({},u,{points:r}))}})}else{var c={round:{id:e,__typename:"Round"},user:{id:n,__typename:"User"},trackIndex:t,points:r,id:g.a.randomBytes(16).toString("hex"),__typename:"Point"};ae.writeQuery({query:A,variables:{roundId:e},data:{allPoints:o.allPoints.concat(c)}})}ue(!1)},Oe=function(e){var n=ae.readQuery({query:A,variables:{roundId:e}});if(0!==n.allPoints.length){var t=n.allPoints.map((function(e){return e.trackIndex})).sort((function(e,n){return n-e}))[0];ae.writeQuery({query:A,variables:{roundId:e},data:{allPoints:n.allPoints.filter((function(e){return e.trackIndex!==t}))}}),ue(!1),T>=t&&X(t-1)}},xe=function(){var e,n;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==(e=ae.readQuery({query:A,variables:{roundId:l}})).allPoints.length){t.next=3;break}return t.abrupt("return");case 3:return n=e.allPoints,t.prev=4,t.next=7,i.a.awrap(de(!0));case 7:return t.next=9,i.a.awrap(be({variables:{roundId:l,pointIds:n.map((function(e){return e.id.toString()})),userIds:n.map((function(e){return e.user.id.toString()})),trackIndexes:n.map((function(e){return e.trackIndex})),points:n.map((function(e){return e.points}))}}));case 9:de(!1),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),fe(t.t0);case 15:case"end":return t.stop()}}),null,null,[[4,12]])},Ne=Object(d.c)(U,{skip:!V}),Qe=Object(d.c)(J,{skip:!V}),Pe=Object(d.c)(A,{skip:!l||!V,variables:{roundId:l}}),Se=Object(d.c)(_,{skip:!V}),Re=Object(d.c)(B,{skip:!V});return o.a.createElement(m.a,null,V&&o.a.createElement(f,{show:!0,doLogout:me,setPage:te,meQuery:Re,currentRoundId:l}),C&&o.a.createElement("div",{className:"error"},C),!V&&o.a.createElement(h,{doLogin:function(e,n){var t,a,r;return i.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,i.a.awrap(we({variables:{username:e,password:n}}));case 2:if(!(t=o.sent)){o.next=13;break}if(a=t.data.login.token,r=t.data.login.username,!a){o.next=13;break}return o.next=9,i.a.awrap(ae.resetStore());case 9:localStorage.setItem("token",a),localStorage.setItem("username",r),W(a),te("main");case 13:case"end":return o.stop()}}))},show:!0,handleError:fe}),V&&!l&&o.a.createElement(E,{addNewLocation:function(e){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(ye({variables:{name:e}}));case 2:case"end":return n.stop()}}))},allLocationsQuery:Ne,allUsersQuery:Qe,handleLocationClick:function(e){return function(){P(e===Q?null:e)}},handleUserClick:function(e){return function(){j.includes(e)?O(j.filter((function(n){return n!==e}))):O(j.concat(e))}},currentLocation:Q,currentPlayers:j,startNewRound:function(){var e;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(ve({variables:{userIds:j.map((function(e){return e.id})),locationId:Q.id}}));case 2:e=n.sent,k(e.data.addRound),u(e.data.addRound.id);case 5:case"end":return n.stop()}}))},show:"round"===ne}),V&&o.a.createElement(v,{allRoundsQuery:Se,setRound:function(e){k(e),u(e.id),X(-1),te("round")},deleteRound:function(e){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(ke({variables:{roundId:e.id}}));case 2:case"end":return n.stop()}}))},show:"main"===ne}),V&&l&&o.a.createElement(p,{allPointsQuery:Pe,round:y,addNewTrack:function(){var e=ae.readQuery({query:A,variables:{roundId:l}}).allPoints,n=-1;e.forEach((function(e){e.trackIndex>n&&(n=e.trackIndex)})),y.users.forEach((function(e){je(l,e.id,n+1,3)}))},updatePoint:function(e,n){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:je(l,n,T,e);case 1:case"end":return t.stop()}}))},deleteLastTrack:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:Oe(l);case 1:case"end":return e.stop()}}))},changeTrack:function(e){X(e)},trackIndex:T,finishRound:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(xe());case 2:k(null),u(null),O([]),P(null),te("main");case 7:case"end":return e.stop()}}))},uploadPoints:xe,show:"round"===ne,savedState:le,uploadingPoints:se}),o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement("em",null,"Frisbeegolf app ","\xa9"," 2020 Juho Taipale")))},G=t(14),K=t(369),V=t(162),W=t(161),Z=t(158),ee=t(17),ne=t(157),te=t(3),ae=window.location.origin.replace(/^http/,"ws"),re="".concat(ae,"/graphql");console.log("websocket uri",re),console.log("http uri","/graphql");var oe=new ne.a({uri:re}),le=Object(V.a)({uri:"/graphql"}),ue=Object(Z.a)((function(e,n){var t=n.headers,r=localStorage.getItem("token");return{headers:Object(a.a)({},t,{authorization:r?"bearer ".concat(r):null})}})),ce=Object(ee.d)((function(e){var n=e.query,t=Object(te.l)(n),a=t.kind,r=t.operation;return"OperationDefinition"===a&&"subscription"===r}),oe,ue.concat(le)),ie=new K.a({link:ce,cache:new W.a});u.a.render(o.a.createElement(G.a,{client:ie},o.a.createElement(G.a,{client:ie},o.a.createElement(X,null))),document.getElementById("root"))},50:function(e,n,t){}},[[174,1,2]]]);
//# sourceMappingURL=main.15ad117b.chunk.js.map